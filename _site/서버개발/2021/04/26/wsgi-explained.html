<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ? | Curious Libertine</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤." />
<meta property="og:description" content="Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤." />
<link rel="canonical" href="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html" />
<meta property="og:url" content="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html" />
<meta property="og:site_name" content="Curious Libertine" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-26T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-04-26T00:00:00+09:00","datePublished":"2021-04-26T00:00:00+09:00","description":"Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤.","headline":"Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html"},"url":"http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html"}</script>
<!-- End Jekyll SEO tag -->


<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Curious Libertine" />





<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open%20Sans|Roboto|Roboto%20Slab|Inconsolata|Dancing%20Script|Noto%20Sans%20SC|Noto%20Sans%20TC|Noto%20Serif%20SC|Noto%20Serif%20TC|Ma%20Shan%20Zheng">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/skin.css">

<!-- Begin selecting skin -->

<!-- End selecting skin -->

<script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<link rel="shortcut icon" href="/assets/favicons.ico/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons.ico/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons.ico/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons.ico/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons.ico/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons.ico/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons.ico/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons.ico/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons.ico/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons.ico/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicons.ico/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons.ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons.ico/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons.ico/favicon-16x16.png">
<link rel="manifest" href="/assets/favicons.ico/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/favicons.ico/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  </head>

  <body>
    <div class="site-container">
      <header class="site-header">
        <div class="wrapper">
  <script>
    function clickSidebarButton() {
      const elem = document.getElementById("site-sidebar")
      if (elem.style.display == "none" || elem.style.display == "") {
        elem.style.display = "block";
      } else {
        elem.style.display = "none";
      }
    }
  </script>
  <a class="site-sidebar-button" onclick="clickSidebarButton()"><i class="far fa-user"></i>
  </a>

  <a class="site-title" rel="author" href="/">Curious Libertine</a>

  
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger" title="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <ul class="trigger">
              <li><a class="" href="/about/">About</a></li>
            
              <li><a class="" href="/categories/">Categories</a></li>
            
              <li><a class="" href="/tags/">Tags</a></li>
            
              <li><a class="" href="/years/">Years</a></li>
            </ul>
    </nav>
  
</div>

      </header>
      
      <div class="site-body wrapper">
        <aside class="site-sidebar" id="site-sidebar">
          
            <h3 class="toc-title">Table of Contents</h3>
<nav class="toc-nav">
  <ul class="toc">
  <li><a href="#1-wsgiì˜-ë“±ì¥-ë°°ê²½">1. WSGIì˜ ë“±ì¥ ë°°ê²½</a>
    <ul>
      <li><a href="#3ê³„ì¸µ-ì‹œìŠ¤í…œê³¼-cgi">3ê³„ì¸µ ì‹œìŠ¤í…œê³¼ CGI</a></li>
      <li><a href="#wsgiì˜-ë“±ì¥">WSGIì˜ ë“±ì¥</a></li>
    </ul>
  </li>
  <li><a href="#2-wsgiì˜-ë™ì‘-ê³¼ì •">2. WSGIì˜ ë™ì‘ ê³¼ì •</a>
    <ul>
      <li><a href="#applicationframework-side">Application/Framework Side</a></li>
      <li><a href="#servergateway-side">Server/Gateway Side</a></li>
    </ul>
  </li>
  <li><a href="#3-frameworkì˜-wsgi-application">3. Frameworkì˜ WSGI application</a>
    <ul>
      <li><a href="#django">Django</a></li>
      <li><a href="#flask">Flask</a></li>
    </ul>
  </li>
  <li><a href="#4-ì •ë¦¬">4. ì •ë¦¬</a></li>
  <li><a href="#ê·¸ë˜ì„œ-ê²°ë¡ ì€">ê·¸ë˜ì„œ ê²°ë¡ ì€?</a>
    <ul>
      <li><a href="#ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</a></li>
      <li><a href="#ë”-ì•Œì•„ë³´ê³ -ì‹¶ì€-ë‚´ìš©">ë” ì•Œì•„ë³´ê³  ì‹¶ì€ ë‚´ìš©</a></li>
    </ul>
  </li>
</ul>

</nav>

          
        </aside>
        <main class="site-main" id="site-main" aria-label="Content" tabindex="1">
          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title p-name" itemprop="name headline">Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-04-26T00:00:00+09:00" itemprop="datePublished">
        Apr 26, 2021
      </time>â€¢ 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">jimin-mjl</span></span></p>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤.</p>

<p>ê·¸ëŸ°ë° ì–˜ë„¤ê°€ ë­ê¸¸ë˜? í•˜ëŠ” ì˜ë¬¸ì´ ë“ ë‹¤. Nginxì™€ ApacheëŠ” ì›¹ ì„œë²„ë¼ëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì„œ ì•Œê² ë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ê³  ì•±ì— ì „ë‹¬í•´ì„œ ì•±ì˜ responseë¥¼ ë‹¤ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•´ì£¼ëŠ” ì—­í• ì´ë¼ëŠ” ê²ƒë„ ì•Œê² ë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ Gunicornê³¼ uWSGIëŠ” ë­ì§€? ì–˜ë„¤ëŠ” ì™œ ìˆëŠ” ê±¸ê¹Œ? ì—†ì–´ë„ ë˜ëŠ” ê±´ê°€? í•˜ëŠ” ìƒê°ì´ ë“¤ê¸° ë§ˆë ¨ì´ë‹¤. ì‹¤ì œë¡œ Gunicornì„ ì“°ì§€ ì•Šê³  Nginxë¡œë§Œ ë°°í¬í•œë‹¤ëŠ” ì†Œë¦¬ë„ ë“¤ì—ˆë‹¤. ì—¬ê¸°ì„œ Gunicornì€ ì—†ì–´ë„ ë˜ì§€ë§Œ ìˆìœ¼ë©´ ì¢‹ì€ ë¯¸ë“¤ì›¨ì–´êµ¬ë‚˜, í•˜ê³  ìƒê°í–ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° Nginx ì—†ì´ Gunicornìœ¼ë¡œë§Œ ë°°í¬í•œë‹¤ëŠ” ì†Œë¦¬ë¥¼ ë“¤ì—ˆë‹¤.</p>

<p>???</p>

<p>ì›¹ ì„œë²„ì˜ ì—­í• ì„ í•˜ëŠ” Nginxê°€ ì—†ì–´ë„ ê°€ëŠ¥í•œê±´ê°€? í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.  ê·¸ë˜ì„œ Nginx, Gunicornì´ ë„ëŒ€ì²´ ë¬´ìŠ¨ ì¼ì„ í•˜ëŠ” ì• ë“¤ì´ê³ , íŒŒì´ì¬ ì•±ê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ì„œ ë™ì‘í•˜ëŠ” ê²ƒì¸ì§€ ì•Œì•„ë³´ê³ ì í•œë‹¤.</p>

<p>Nginx, gunicorn, Djangoê°€ ëª¨ë‘ ì„œë²„ ì—­í• ì„ í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, ì´ë ‡ê²Œ ë‚˜ëˆ ì ¸ ìˆëŠ” ì„œë²„ì˜ ê³„ì¸µ ì‹œìŠ¤í…œê³¼ WSGIë¼ëŠ” ê²ƒì— ëŒ€í•´ ë¨¼ì € ì•Œì•„ë³¼ í•„ìš”ê°€ ìˆë‹¤.</p>

<h2 id="1-wsgiì˜-ë“±ì¥-ë°°ê²½">1. WSGIì˜ ë“±ì¥ ë°°ê²½</h2>

<h3 id="3ê³„ì¸µ-ì‹œìŠ¤í…œê³¼-cgi">3ê³„ì¸µ ì‹œìŠ¤í…œê³¼ CGI</h3>

<p>3ê³„ì¸µ ì„œë²„ ì‹œìŠ¤í…œì— ëŒ€í•´ ë“¤ì–´ë³¸ ì  ìˆì„ ê²ƒì´ë‹¤. DB ì„œë²„ëŠ” ì°¨ì¹˜í•˜ê³  ì›¹ ì„œë²„ì™€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë§Œ ì‚´í´ë³´ì. ì´ˆê¸°ì—ëŠ” ì›¹ ì„œë²„ë§Œ ìˆì—ˆë‹¤. í•˜ë“œì›¨ì–´ì— íŒŒì¼ê³¼ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ë‘ì—ˆë‹¤ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ìš”ì²­í•œ íŒŒì¼ì„ í™”ë©´ì— ë„ì›Œì£¼ëŠ” í˜•ì‹ì´ì—ˆë‹¤.</p>

<p>ì´ëŸ° ë°©ì‹ì€ ë¹ ë¥´ê³  í¸í–ˆì§€ë§Œ Only Static, ì •ì ì¸ íŒŒì¼ë°–ì— ê±´ë„¤ì¤„ ìˆ˜ê°€ ì—†ì—ˆë‹¤. ê·¸ëŸ°ë° í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì˜¤ëŠ” ìš”ì²­ì´ ë‹¤ì–‘í•˜ê³  ë³µì¡í•´ì§€ë©´ì„œ ë¡œì§ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë™ì ì¸ íŒŒì¼ì— ëŒ€í•œ ìš”ì²­ì´ ìƒê²¨ë‚˜ê²Œ ë˜ê³ , ì´ëŸ° ì •ì ì¸ íŒŒì¼ë§Œìœ¼ë¡œëŠ” í•œê³„ë¥¼ ëŠë¼ê²Œ ë˜ì—ˆë‹¤.</p>

<p>ê·¸ë˜ì„œ ë“±ì¥í•œ ê²Œ <strong>ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„</strong>ì´ë‹¤. ë°ì´í„° íŒŒì¼ì„ ì €ì¥í•´ë‘ëŠ” ëŒ€ì‹ , ì†ŒìŠ¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„œë²„ì— ì €ì¥í•´ë†“ê³  ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼œ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ê²ƒì´ë‹¤. ì‰½ê²Œ ë§í•´ ì†ŒìŠ¤ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ” ì›¹ ì•± ìì²´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ëŠ” ì›¹ ì„œë²„ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ê·¸ëŸ°ë°, ì—¬ê¸°ì„œ <strong>íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–»ê²Œ HTTP ìš”ì²­ì„ ë°›ì„ ê²ƒì¸ê°€</strong>, í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.</p>

<p>HTTP ìš”ì²­ì€ ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">GET /home.html HTTP/1.1</code> ê³¼ ê°™ì€ í…ìŠ¤íŠ¸ì´ê³ , ì´ëŠ” íŒŒì´ì¬ ì•±ì´ ë°›ëŠ” request objectì˜ í˜•ì‹ê³¼ëŠ” ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p>ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì˜¤ëŠ” HTTP ìš”ì²­ì„ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ìš”êµ¬í•˜ëŠ” ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ê³  ì‘ë‹µì„ ëŒë ¤ì¤„ ë•Œë„ íŒŒì´ì¬ ë°ì´í„°ë¥¼ HTTP í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•œë°, ì´ ë•Œ íŒŒì´ì¬ ì•± ì„œë²„ê°€ ë™ì‘í•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ì‹ì´ <strong>CGI, Common Gateway Interface</strong>ì´ë‹¤.</p>

<p>ì¦‰, CGIë€ íŒŒì´ì¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì— ëŒ€í•œ specification(ì‚¬ì–‘, ë§¤ë‰´ì–¼)ì´ë¼ê³  í•  ìˆ˜ ìˆê³  ê·¸ ê¸°ë³¸ì ì¸ ë™ì‘ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<ul>
  <li>ì¸í’‹ìœ¼ë¡œ HTTP ìš”ì²­ì„ ë°›ëŠ”ë‹¤.</li>
  <li>ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ í™˜ê²½ë³€ìˆ˜ì˜ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì˜ stdin í˜•ì‹ì˜ ì¸í’‹ìœ¼ë¡œ ë°›ëŠ”ë‹¤.</li>
  <li>ìŠ¤í¬ë¦½íŠ¸ê°€ printì™€ ê°™ì€ stdout í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ë©´ HTTP í˜•ì‹ìœ¼ë¡œ ë³€í™˜ëœë‹¤.</li>
</ul>

<h3 id="wsgiì˜-ë“±ì¥">WSGIì˜ ë“±ì¥</h3>

<p>ê·¸ëŸ°ë° CGIëŠ” í•œ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆëŠ”ë°, ë°”ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì²˜ìŒë¶€í„° ì‹¤í–‰í•œë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ì„œë²„ê°€ ë„ˆë¬´ ëŠë¦¬ê³  íš¨ìœ¨ë„ ì¢‹ì§€ ì•Šì•˜ë‹¤.</p>

<p>ì´ ë•Œ ë“±ì¥í•œ ê²Œ <strong>WSGI(Web Server Gateway Interface)</strong>ì´ë‹¤. CGIì²˜ëŸ¼ WSGI ë˜í•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì— ëŒ€í•œ specificationì¸ë°, ê¸°ë³¸ì ì¸ ì•„ì´ë””ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p>ì›¹ ì„œë²„ì™€ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶„ë¦¬í•˜ê³  ì›¹ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ì„œ ìŠ¤í¬ë¦½íŠ¸ì— ì „ë‹¬í•´ì£¼ë©´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²Œ ì•„ë‹ˆë¼ í•„ìš”í•œ ë¡œì§ í•˜ë‚˜ë§Œ ì‹¤í–‰í•œ í›„ ê²°ê³¼ë¥¼ ì‘ë‹µí•´ì£¼ëŠ” ì‹ìœ¼ë¡œ ë™ì‘í•¨ìœ¼ë¡œì¨ ë™ì ì¸ ì½˜í…ì¸ ì— ëŒ€í•œ ìš”ì²­ì— ë¹ ë¥´ê²Œ ì‘ë‹µí•  ìˆ˜ ìˆê²Œ í•œ ê²ƒì´ë‹¤.</p>

<p>ì´ëŸ¬í•œ WSGIê°€ í‘œì¤€ì ì¸ íŒŒì´ì¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì´ ë¨ì— ë”°ë¼, WSGI ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ëŠ” ì›¹ ì„œë²„ì˜ ì—­í• ì„ í•˜ê²Œ ë˜ê³  WSGI compatibleí•œ íŒŒì´ì¬ ì•±ì´ WSGI ì„œë²„ì™€ í•©ì³ì ¸ì„œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ ë˜ê²Œ ëœë‹¤.
<img src="https://images.velog.io/images/jimin_lee/post/19d94186-29f9-4cf2-a9c3-0b9e7bb39086/KakaoTalk_20210425_212448657_01.jpg" alt="" /></p>

<p>ì¦‰, ì—¬ê¸°ì„œ WSGI ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ì• ê°€ Gunicornì´ê³ , DjangoëŠ” íŒŒì´ì¬ ì•±ì´ë¼ê³  í•  ìˆ˜ ìˆìœ¼ë©°, ì–˜ë„¤ê°€ í•¨ê»˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ ë˜ëŠ” ê²ƒì´ë‹¤. NginxëŠ” ì—¬ê¸°ì„œ Gunicorn+Djangoì˜ ì•ë‹¨ì— ìœ„ì¹˜í•˜ê³  ìˆëŠ”ë°, WSGIì˜ í”„ë¡œì„¸ìŠ¤ì™€ëŠ” ë³„ ê´€ë ¨ ì—†ì´ buffering, reverse proxyë‚˜ load balanceì™€ ê°™ì€ ë³„ë„ì˜ ì¼ì„ ìˆ˜í–‰í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.</p>

<h2 id="2-wsgiì˜-ë™ì‘-ê³¼ì •">2. WSGIì˜ ë™ì‘ ê³¼ì •</h2>

<p>WSGIì— ëŒ€í•´ ì¢€ ë” ê°ì„ ì¡ê¸° ìœ„í•´ <a href="https://www.python.org/dev/peps/pep-0333/#specification-overview">PEP333</a>ì— ë‚˜ì™€ìˆëŠ” WSGIì˜ ë™ì‘ ê³¼ì •ì„ í•œ ë²ˆ ì‚´í´ë³´ë ¤ê³  í•œë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ë§í•˜ì§€ë§Œ WSGIëŠ” ë³„ë„ì˜ í”„ë ˆì„ì›Œí¬ ê°™ì€ ê²Œ ì•„ë‹ˆë¼, ë™ì ì¸ ë°ì´í„°ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ì„œ ì›¹ ì„œë²„ì™€ íŒŒì´ì¬ ì›¹ ì•±ì´ ì–´ë–»ê²Œ ì„œë¡œ ë™ì‘í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” specificationì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.</p>

<p>ê³µì‹ ë¬¸ì„œì—ì„œëŠ” WSGIë¥¼ <strong>â€œsimple and universal interface between web servers and web applications or frameworksâ€</strong>ë¼ê³  ì„¤ëª…í•˜ê³  ìˆìœ¼ë©°, WSGIì˜ ëª©ì ì€ <strong>â€œto facilitate easy interconnection of existing servers and applications or frameworks, not to create a new web frameworkâ€</strong>ë¼ê³  ì„œìˆ í•˜ê³  ìˆë‹¤.</p>

<p>WSGIëŠ” server/gateway sideì™€ application/framework sideë¥¼ ê°€ì§€ëŠ”ë°, server sideì—ì„œ ë“¤ì–´ì˜¨ ìš”ì²­ì´ application sideì˜ callable objectë¥¼ í˜¸ì¶œ(invoke)í•˜ê²Œ ëœë‹¤. ì—¬ê¸°ì„œ callable objectë€ ê³§ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜í•œ applicationì„ ì˜ë¯¸í•˜ê³ , objectë¼ê³ ëŠ” í–ˆì§€ë§Œ callableí•œ ì–´ë–¤ í˜•íƒœë“ ì§€ ìƒê´€ì€ ì—†ë‹¤.</p>

<p><img src="https://images.velog.io/images/jimin_lee/post/d5fd03ea-666a-4a0b-8a03-d574cd7a34f0/KakaoTalk_20210425_212448657.jpg" alt="" /></p>

<p>ê°ê°ì˜ ì½”ë“œë¥¼ í•œ ë²ˆ ì‚´í´ë³´ì.</p>

<h3 id="applicationframework-side">Application/Framework Side</h3>

<p>ë‹¤ìŒì€ í•¨ìˆ˜ í˜•íƒœì˜ applicationì´ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="s">"""Simplest possible application object"""</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">'200 OK'</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text/plain'</span><span class="p">)]</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">'Hello world!</span><span class="se">\n</span><span class="s">'</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>applicationì€ environ ê°ì²´ì™€ start_responseë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.</li>
  <li>environì€ methodë‚˜ url ë“± HTTP ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ CGI í™˜ê²½ ë³€ìˆ˜ì˜ í˜•ì‹ìœ¼ë¡œ ë‹´ê³  ìˆëŠ” dictionary í˜•íƒœì˜ ê°ì²´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.</li>
  <li>start_response ì½œë°± í•¨ìˆ˜ëŠ” statusì™€ response_headersë¼ëŠ” ë‘ ê°€ì§€ ì¸ìë¥¼ ë°›ëŠ”ë‹¤.</li>
  <li>statusì—ëŠ” <code class="language-plaintext highlighter-rouge">200 OK</code> ì™€ ê°™ì€ HTTP status ì½”ë“œê°€ ë“¤ì–´ê°€ê³ , response_headersì—ëŠ” HTTP í—¤ë”ê°€ ë“¤ì–´ê°„ë‹¤.</li>
</ul>

<h3 id="servergateway-side">Server/Gateway Side</h3>

<p>server sideì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ applicationì„ í˜¸ì¶œí•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span>

<span class="k">def</span> <span class="nf">run_with_cgi</span><span class="p">(</span><span class="n">application</span><span class="p">):</span> <span class="c1"># applicationì„ ì¸ìë¡œ ë°›ìŒ
</span>    <span class="c1"># environ ê°ì²´
</span>    <span class="n">environ</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.input'</span><span class="p">]</span>        <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>  <span class="c1"># stdinì˜ í˜•íƒœë¡œ inputì„ ë°›ìŒ
</span>    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.errors'</span><span class="p">]</span>       <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.version'</span><span class="p">]</span>      <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.multithread'</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">False</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.multiprocess'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.run_once'</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'HTTPS'</span><span class="p">,</span> <span class="s">'off'</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s">'on'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">):</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.url_scheme'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'https'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.url_scheme'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'http'</span>

    <span class="n">headers_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">headers_sent</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">headers_set</span><span class="p">:</span>
             <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">"write() before start_response()"</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">headers_sent</span><span class="p">:</span>
             <span class="c1"># Before the first output, send the stored headers
</span>             <span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span> <span class="o">=</span> <span class="n">headers_sent</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">headers_set</span>
             <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'Status: %s</span><span class="se">\r\n</span><span class="s">'</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">response_headers</span><span class="p">:</span>
                 <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'%s: %s</span><span class="se">\r\n</span><span class="s">'</span> <span class="o">%</span> <span class="n">header</span><span class="p">)</span>
             <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>

        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>

		<span class="c1"># statusì™€ response_headersë¥¼ ë°›ëŠ” start_response ì½œë°±í•¨ìˆ˜ 
</span>    <span class="k">def</span> <span class="nf">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">headers_sent</span><span class="p">:</span>
                    <span class="c1"># Re-raise original exception if headers sent
</span>                    <span class="k">raise</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">exc_info</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c1"># avoid dangling circular ref
</span>        <span class="k">elif</span> <span class="n">headers_set</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">"Headers already set!"</span><span class="p">)</span>

        <span class="n">headers_set</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">write</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>    <span class="c1"># don't send headers until body appears
</span>                <span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">headers_sent</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>   <span class="c1"># send headers now if body was empty
</span>    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">'close'</span><span class="p">):</span>
            <span class="n">result</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> 
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ì°¸ê³ </code> <strong>WSGI Middleware</strong></p>

<ul>
  <li>WSGI server/gateway sideì™€ application/framework sideë¥¼ ë‘˜ ë‹¤ êµ¬í˜„í•˜ê³  ìˆëŠ” í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨</li>
  <li>ì„œë²„ì— ëŒ€í•´ì„œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê³ , ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ì„œëŠ” ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰.</li>
  <li>ë™ì‘ ê³¼ì • : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ â†’ server sideì—ì„œ middleware componentë¥¼ í˜¸ì¶œ â†’ middleware componentê°€ application sideì˜ applicationì„ í˜¸ì¶œ</li>
  <li><strong>Gunicorn, uWSGI</strong></li>
</ul>

<h2 id="3-frameworkì˜-wsgi-application">3. Frameworkì˜ WSGI application</h2>

<p>ì´ë²ˆì—ëŠ” ëŒ€í‘œì ì¸ íŒŒì´ì¬ í”„ë ˆì„ì›Œí¬ì¸ Djangoì™€ Flaskì— ë‚´ì¥ëœ WSGI applicationì„ í•œ ë²ˆ ì‚´í´ë³´ë ¤ê³  í•œë‹¤.</p>

<h3 id="django">Django</h3>

<p>ğŸ“ django projectë¥¼ ìƒì„±í•˜ë©´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” wsgi.py íŒŒì¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""
WSGI config for movie_project project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/3.1/howto/deployment/wsgi/
"""</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>

<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">'DJANGO_SETTINGS_MODULE'</span><span class="p">,</span> <span class="s">'movie_project.settings'</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">get_wsgi_application</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ django.core.wsgi.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.core.handlers.wsgi</span> <span class="kn">import</span> <span class="n">WSGIHandler</span>

<span class="k">def</span> <span class="nf">get_wsgi_application</span><span class="p">():</span>
    <span class="s">"""
    The public interface to Django's WSGI support. Return a WSGI callable.
    Avoids making django.core.handlers.WSGIHandler a public API, in case the
    internal WSGI implementation changes or moves in the future.
    """</span>
    <span class="n">django</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">set_prefix</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">WSGIHandler</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ django.core.handlers.wsgi.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">WSGIHandler</span><span class="p">(</span><span class="n">base</span><span class="p">.</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="n">request_class</span> <span class="o">=</span> <span class="n">WSGIRequest</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">load_middleware</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">set_script_prefix</span><span class="p">(</span><span class="n">get_script_name</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
        <span class="n">signals</span><span class="p">.</span><span class="n">request_started</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">request_class</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="n">response</span><span class="p">.</span><span class="n">_handler_class</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s">'%d %s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">reason_phrase</span><span class="p">)</span>
        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="n">response</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span>
            <span class="o">*</span><span class="p">((</span><span class="s">'Set-Cookie'</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">''</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="p">]</span>
        <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'file_to_stream'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'wsgi.file_wrapper'</span><span class="p">):</span>
            <span class="c1"># If `wsgi.file_wrapper` is used the WSGI server does not call
</span>            <span class="c1"># .close on the response, but on the file wrapper. Patch it to use
</span>            <span class="c1"># response.close instead which takes care of closing all files.
</span>            <span class="n">response</span><span class="p">.</span><span class="n">file_to_stream</span><span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">close</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.file_wrapper'</span><span class="p">](</span><span class="n">response</span><span class="p">.</span><span class="n">file_to_stream</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h3 id="flask">Flask</h3>

<p>ğŸ“ flask app.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"Hello World!"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ flask.src.flask.app.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">Scaffold</span><span class="p">):</span>
    <span class="s">"""The flask object implements a WSGI application and acts as the central
    object.  It is passed the name of the module or package of the
    application.  Once it is created it will act as a central registry for
    the view functions, the URL rules, template configuration and much more.
    The name of the package is used to resolve resources from inside the
    package or the folder the module is contained in depending on if the
    package parameter resolves to an actual python package (a folder with
    an :file:`__init__.py` file inside) or a standard module (just a ``.py`` file).
    """</span>

	<span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
	        <span class="s">"""The actual WSGI application. This is not implemented in
	        :meth:`__call__` so that middlewares can be applied without
	        losing a reference to the app object. Instead of doing this::
	            app = MyMiddleware(app)
	        It's a better idea to do this instead::
	            app.wsgi_app = MyMiddleware(app.wsgi_app)
	        Then you still have the original application object around and
	        can continue to call methods on it.
	        
	        :param environ: A WSGI environment. 
	        :param start_response: A callable accepting a status code,
	            a list of headers, and an optional exception context to
	            start the response.
	        """</span>
	        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
	        <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
	        <span class="k">try</span><span class="p">:</span>
	            <span class="k">try</span><span class="p">:</span>
	                <span class="n">ctx</span><span class="p">.</span><span class="n">push</span><span class="p">()</span>
	                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">full_dispatch_request</span><span class="p">()</span>
	            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	                <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
	                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
	            <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: B001
</span>	                <span class="n">error</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
	                <span class="k">raise</span>
	            <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
	        <span class="k">finally</span><span class="p">:</span>
	            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">should_ignore_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
	                <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
	            <span class="n">ctx</span><span class="p">.</span><span class="n">auto_pop</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="s">"""The WSGI server calls the Flask application object as the
            WSGI application. This calls :meth:`wsgi_app`, which can be
            wrapped to apply middleware.
            """</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">wsgi_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="4-ì •ë¦¬">4. ì •ë¦¬</h2>

<p>âœ” <strong>Gunicornì€ ì™œ í•„ìš”í•œê°€?</strong> ì›¹ ì•±ì— HTTP ìš”ì²­ì„ ì „ë‹¬í•˜ê³  ì‘ë‹µì„ ë˜ëŒë ¤ì£¼ëŠ” ì¼ì„ í•  WSGI serverì˜ ì—­í• ì„ í•˜ê¸° ìœ„í•´ì„œ â†’ WSGI middleware</p>

<p>âœ” <strong>NginxëŠ” ì™œ í•„ìš”í•œê°€?</strong> reverse proxy server, load balancer ë“±ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ</p>

<p>âœ” <strong>Django/FlaskëŠ” ì™œ í•„ìš”í•œê°€?</strong> WSGI compatible serverë¥¼ ì•Œì•„ì„œ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. raw WSGI applicationì„ ë§Œë“¤ ìˆ˜ëŠ” ìˆì§€ë§Œ ê¸°ëŠ¥ì„ ì¼ì¼ì´ ë‹¤ êµ¬í˜„í•˜ê¸° ë²ˆê±°ë¡­ê³  ë„ˆë¬´ ë§ì€ ì½”ë„ˆ ì¼€ì´ìŠ¤ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ê¶Œì¥í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.  ê·¸ë˜ì„œ ì´ë¯¸  sessionì´ë‚˜ cookieì™€ ê°™ì€ ë§ì€ ë¶€ë¶„ì´ êµ¬í˜„ë˜ì–´ ìˆëŠ” í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ëŠ” ê²ƒì´ë‹¤.</p>

<p>âœ” <strong>ê·¸ëŸ¼ ê·¸ëƒ¥ í”„ë ˆì„ì›Œí¬ ì„œë²„ë¥¼ ì›¹ ì„œë²„ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?</strong> ê·¸ë˜ë„ ì•ˆë  ê±´ ì—†ë‹¤. í•˜ì§€ë§Œ ë³´í†µì€ ê·¸ëŸ¬ì§€ ì•ŠëŠ”ë‹¤. í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” development serverëŠ” ì‹¤ì œ íŠ¸ë˜í”½ì— ëŒ€ì‘í•  ìˆ˜ ì—†ê³  ì—¬ëŸ¬ ë¶€ë¶„ì—ì„œ ë¹ˆì•½í•˜ê¸° ë•Œë¬¸ì´ë‹¤. Flask ì•±ì„ ë§Œë“¤ ë•Œ <code class="language-plaintext highlighter-rouge">flask run</code>ì„ í†µí•´ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ í„°ë¯¸ë„ì— production serverìš©ìœ¼ë¡œëŠ” ì“°ì§€ ë§ë¼ëŠ” ë©”ì„¸ì§€ê°€ ë‚˜ì˜¤ëŠ” ì´ìœ ë„ ì´ ë•Œë¬¸ì´ë‹¤.</p>

<h2 id="ê·¸ë˜ì„œ-ê²°ë¡ ì€">ê·¸ë˜ì„œ ê²°ë¡ ì€?</h2>

<p>âœ… <strong>Gunicornë§Œ ì¨ë„ ë¼?</strong> YES.</p>

<p>Gunicornì´ WSGI middlewareë¡œì„œ ì›¹ ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— Gunicornë§Œ ì¨ë„ ëœë‹¤. ë‹¤ë§Œ, Nginxê°€ ì œê³µí•˜ëŠ” ì¶”ê°€ì ì¸ í˜œíƒì„ ë°›ì§€ ëª»í•  ë¿ì´ë‹¤.</p>

<p>âœ… <strong>Nginxë§Œ ì¨ë„ ë¼?</strong>  YES.</p>

<p>Flaskë‚˜ Django ê°™ì€ í”„ë ˆì„ì›Œí¬ëŠ” WSGI interfaceë¥¼ ì´ë¯¸ ì–´ëŠ ì •ë„ êµ¬í˜„í•´ë†“ì•˜ê¸° ë•Œë¬¸ì— í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ Nginxë§Œ ì¨ë„ ëœë‹¤. ë‹¤ë§Œ session, cookie, routing, authentication ë“±ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì£¼ëŠ” middlewareì˜ ì—­í• ì„ í•˜ëŠ” ì• ê°€ ì—†ê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ì€ ìê¸°ê°€ í•˜ë“œ ì½”ë”©í•´ì•¼ í•œë‹¤. ê²°êµ­, Gunicorn/uWSGIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ë‹¤ ì“°ëŠ” ê²ƒê³¼ ë˜‘ê°™ë‹¤ê³  í•  ìˆ˜ ìˆê³ , ë°˜ë“œì‹œ ì¨ì•¼ë§Œ í•˜ëŠ” ê±´ ì•„ë‹ˆë‹¤.</p>

<hr />
<h3 id="ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</h3>

<ul>
  <li><a href="https://youtu.be/WqrCnVAkLIo">https://youtu.be/WqrCnVAkLIo</a></li>
  <li><a href="https://youtu.be/H6Q3l11fjU0">https://youtu.be/H6Q3l11fjU0</a></li>
  <li><a href="https://www.python.org/dev/peps/pep-0333/#specification-overview">https://www.python.org/dev/peps/pep-0333/#specification-overview</a> (PEP333)</li>
  <li><a href="https://www.nginx.com/resources/glossary/application-server-vs-web-server/">https://www.nginx.com/resources/glossary/application-server-vs-web-server/</a></li>
  <li><a href="https://www.fullstackpython.com/green-unicorn-gunicorn.html#:~:text=Gunicorn%20is%20based%20on%20a,is%20independent%20of%20the%20controller">https://www.fullstackpython.com/green-unicorn-gunicorn.html#:~:text=Gunicorn is based on a,is independent of the controller</a>.</li>
  <li><a href="https://sgc109.github.io/2020/08/15/python-wsgi/">https://sgc109.github.io/2020/08/15/python-wsgi/</a></li>
  <li><a href="http://xplordat.com/2020/02/16/a-flask-full-of-whiskey-wsgi/">http://xplordat.com/2020/02/16/a-flask-full-of-whiskey-wsgi/</a></li>
</ul>

<h3 id="ë”-ì•Œì•„ë³´ê³ -ì‹¶ì€-ë‚´ìš©">ë” ì•Œì•„ë³´ê³  ì‹¶ì€ ë‚´ìš©</h3>

<ul>
  <li>ASGI : <a href="https://youtu.be/uRcnaI8Hnzg">https://youtu.be/uRcnaI8Hnzg</a></li>
</ul>

  </div>

  <footer class="post-footer">
    
      <div class="post-meta">
        <i class="fas fa-folder"></i>
        <ul class="post-taxonomies post-categories">
          
          
            <li class="post-category">
              
              <a href="/categories/#%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C">ì„œë²„ê°œë°œ</a>
            </li>
          
        </ul>
      </div>
    

    
      <div class="post-meta">
        <i class="fas fa-tags"></i>
        <ul class="post-taxonomies post-tags">
          
          
            <li class="post-tag">
              
              <a href="/tags/#gunicorn">gunicorn</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#nginx">nginx</a>
            </li>
          
        </ul>
      </div>
    

    <nav class="post-pagination" role="navigation">
      
        <a class="post-previous" href="/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/02/08/deploying-flask-app.html">
          <h4 class="post-pagination-label">Prev</h4>
          <span class="post-pagination-title">
            <i class="fas fa-arrow-left"></i> Nginxì™€ Gunicornìœ¼ë¡œ Flaskì•± ë°°í¬í•˜ê¸°

          </span>
        </a>
      

      
    </nav>
  </footer>

  
  
</article>

          <footer class="site-footer">
            <div class="footer-col-wrapper">

  <div class="footer-col">
    <div class="copyright">
      
      
      
      
      <p>Copyright Â© 2021&nbsp;-&nbsp;2022 jimin-mjl; All rights reserved.</p>
      
    </div>
    <p>
      Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/ngzhio/jekyll-theme-hamilton">Hamilton</a>
    </p>
  </div>

  <div class="footer-col">
    <p>Personal Records of a philosophical libertine.</p>
  </div>
</div>

          </footer>
        </main>
      </div>
    </div>
  </body>

</html>
