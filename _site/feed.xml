<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-05-30T22:40:54+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Curious Libertine</title><subtitle>Personal Records of a philosophical libertine.</subtitle><author><name>jimin-mjl</name></author><entry><title type="html">Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?</title><link href="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html" rel="alternate" type="text/html" title="Nginxì™€ Gunicorn ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¨ë„ ë ê¹Œ?" /><published>2021-04-26T00:00:00+09:00</published><updated>2021-04-26T00:00:00+09:00</updated><id>http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained</id><content type="html" xml:base="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/04/26/wsgi-explained.html"><![CDATA[<p>Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤.</p>

<p>ê·¸ëŸ°ë° ì–˜ë„¤ê°€ ë­ê¸¸ë˜? í•˜ëŠ” ì˜ë¬¸ì´ ë“ ë‹¤. Nginxì™€ ApacheëŠ” ì›¹ ì„œë²„ë¼ëŠ” ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì„œ ì•Œê² ë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ê³  ì•±ì— ì „ë‹¬í•´ì„œ ì•±ì˜ responseë¥¼ ë‹¤ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•´ì£¼ëŠ” ì—­í• ì´ë¼ëŠ” ê²ƒë„ ì•Œê² ë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ Gunicornê³¼ uWSGIëŠ” ë­ì§€? ì–˜ë„¤ëŠ” ì™œ ìˆëŠ” ê±¸ê¹Œ? ì—†ì–´ë„ ë˜ëŠ” ê±´ê°€? í•˜ëŠ” ìƒê°ì´ ë“¤ê¸° ë§ˆë ¨ì´ë‹¤. ì‹¤ì œë¡œ Gunicornì„ ì“°ì§€ ì•Šê³  Nginxë¡œë§Œ ë°°í¬í•œë‹¤ëŠ” ì†Œë¦¬ë„ ë“¤ì—ˆë‹¤. ì—¬ê¸°ì„œ Gunicornì€ ì—†ì–´ë„ ë˜ì§€ë§Œ ìˆìœ¼ë©´ ì¢‹ì€ ë¯¸ë“¤ì›¨ì–´êµ¬ë‚˜, í•˜ê³  ìƒê°í–ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° Nginx ì—†ì´ Gunicornìœ¼ë¡œë§Œ ë°°í¬í•œë‹¤ëŠ” ì†Œë¦¬ë¥¼ ë“¤ì—ˆë‹¤.</p>

<p>???</p>

<p>ì›¹ ì„œë²„ì˜ ì—­í• ì„ í•˜ëŠ” Nginxê°€ ì—†ì–´ë„ ê°€ëŠ¥í•œê±´ê°€? í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.  ê·¸ë˜ì„œ Nginx, Gunicornì´ ë„ëŒ€ì²´ ë¬´ìŠ¨ ì¼ì„ í•˜ëŠ” ì• ë“¤ì´ê³ , íŒŒì´ì¬ ì•±ê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ì„œ ë™ì‘í•˜ëŠ” ê²ƒì¸ì§€ ì•Œì•„ë³´ê³ ì í•œë‹¤.</p>

<p>Nginx, gunicorn, Djangoê°€ ëª¨ë‘ ì„œë²„ ì—­í• ì„ í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, ì´ë ‡ê²Œ ë‚˜ëˆ ì ¸ ìˆëŠ” ì„œë²„ì˜ ê³„ì¸µ ì‹œìŠ¤í…œê³¼ WSGIë¼ëŠ” ê²ƒì— ëŒ€í•´ ë¨¼ì € ì•Œì•„ë³¼ í•„ìš”ê°€ ìˆë‹¤.</p>

<h2 id="1-wsgiì˜-ë“±ì¥-ë°°ê²½">1. WSGIì˜ ë“±ì¥ ë°°ê²½</h2>

<h3 id="3ê³„ì¸µ-ì‹œìŠ¤í…œê³¼-cgi">3ê³„ì¸µ ì‹œìŠ¤í…œê³¼ CGI</h3>

<p>3ê³„ì¸µ ì„œë²„ ì‹œìŠ¤í…œì— ëŒ€í•´ ë“¤ì–´ë³¸ ì  ìˆì„ ê²ƒì´ë‹¤. DB ì„œë²„ëŠ” ì°¨ì¹˜í•˜ê³  ì›¹ ì„œë²„ì™€ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë§Œ ì‚´í´ë³´ì. ì´ˆê¸°ì—ëŠ” ì›¹ ì„œë²„ë§Œ ìˆì—ˆë‹¤. í•˜ë“œì›¨ì–´ì— íŒŒì¼ê³¼ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ë‘ì—ˆë‹¤ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ìš”ì²­í•œ íŒŒì¼ì„ í™”ë©´ì— ë„ì›Œì£¼ëŠ” í˜•ì‹ì´ì—ˆë‹¤.</p>

<p>ì´ëŸ° ë°©ì‹ì€ ë¹ ë¥´ê³  í¸í–ˆì§€ë§Œ Only Static, ì •ì ì¸ íŒŒì¼ë°–ì— ê±´ë„¤ì¤„ ìˆ˜ê°€ ì—†ì—ˆë‹¤. ê·¸ëŸ°ë° í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì˜¤ëŠ” ìš”ì²­ì´ ë‹¤ì–‘í•˜ê³  ë³µì¡í•´ì§€ë©´ì„œ ë¡œì§ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë™ì ì¸ íŒŒì¼ì— ëŒ€í•œ ìš”ì²­ì´ ìƒê²¨ë‚˜ê²Œ ë˜ê³ , ì´ëŸ° ì •ì ì¸ íŒŒì¼ë§Œìœ¼ë¡œëŠ” í•œê³„ë¥¼ ëŠë¼ê²Œ ë˜ì—ˆë‹¤.</p>

<p>ê·¸ë˜ì„œ ë“±ì¥í•œ ê²Œ <strong>ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„</strong>ì´ë‹¤. ë°ì´í„° íŒŒì¼ì„ ì €ì¥í•´ë‘ëŠ” ëŒ€ì‹ , ì†ŒìŠ¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„œë²„ì— ì €ì¥í•´ë†“ê³  ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼œ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ê²ƒì´ë‹¤. ì‰½ê²Œ ë§í•´ ì†ŒìŠ¤ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ” ì›¹ ì•± ìì²´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ëŠ” ì›¹ ì„œë²„ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ê·¸ëŸ°ë°, ì—¬ê¸°ì„œ <strong>íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–»ê²Œ HTTP ìš”ì²­ì„ ë°›ì„ ê²ƒì¸ê°€</strong>, í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.</p>

<p>HTTP ìš”ì²­ì€ ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">GET /home.html HTTP/1.1</code> ê³¼ ê°™ì€ í…ìŠ¤íŠ¸ì´ê³ , ì´ëŠ” íŒŒì´ì¬ ì•±ì´ ë°›ëŠ” request objectì˜ í˜•ì‹ê³¼ëŠ” ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p>ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì˜¤ëŠ” HTTP ìš”ì²­ì„ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ìš”êµ¬í•˜ëŠ” ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ê³  ì‘ë‹µì„ ëŒë ¤ì¤„ ë•Œë„ íŒŒì´ì¬ ë°ì´í„°ë¥¼ HTTP í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•œë°, ì´ ë•Œ íŒŒì´ì¬ ì•± ì„œë²„ê°€ ë™ì‘í•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ì‹ì´ <strong>CGI, Common Gateway Interface</strong>ì´ë‹¤.</p>

<p>ì¦‰, CGIë€ íŒŒì´ì¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì— ëŒ€í•œ specification(ì‚¬ì–‘, ë§¤ë‰´ì–¼)ì´ë¼ê³  í•  ìˆ˜ ìˆê³  ê·¸ ê¸°ë³¸ì ì¸ ë™ì‘ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<ul>
  <li>ì¸í’‹ìœ¼ë¡œ HTTP ìš”ì²­ì„ ë°›ëŠ”ë‹¤.</li>
  <li>ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ í™˜ê²½ë³€ìˆ˜ì˜ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì˜ stdin í˜•ì‹ì˜ ì¸í’‹ìœ¼ë¡œ ë°›ëŠ”ë‹¤.</li>
  <li>ìŠ¤í¬ë¦½íŠ¸ê°€ printì™€ ê°™ì€ stdout í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ë©´ HTTP í˜•ì‹ìœ¼ë¡œ ë³€í™˜ëœë‹¤.</li>
</ul>

<h3 id="wsgiì˜-ë“±ì¥">WSGIì˜ ë“±ì¥</h3>

<p>ê·¸ëŸ°ë° CGIëŠ” í•œ ê°€ì§€ ë¬¸ì œì ì´ ìˆì—ˆëŠ”ë°, ë°”ë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì²˜ìŒë¶€í„° ì‹¤í–‰í•œë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ì„œë²„ê°€ ë„ˆë¬´ ëŠë¦¬ê³  íš¨ìœ¨ë„ ì¢‹ì§€ ì•Šì•˜ë‹¤.</p>

<p>ì´ ë•Œ ë“±ì¥í•œ ê²Œ <strong>WSGI(Web Server Gateway Interface)</strong>ì´ë‹¤. CGIì²˜ëŸ¼ WSGI ë˜í•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì— ëŒ€í•œ specificationì¸ë°, ê¸°ë³¸ì ì¸ ì•„ì´ë””ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p>ì›¹ ì„œë²„ì™€ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶„ë¦¬í•˜ê³  ì›¹ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ì„œ ìŠ¤í¬ë¦½íŠ¸ì— ì „ë‹¬í•´ì£¼ë©´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²Œ ì•„ë‹ˆë¼ í•„ìš”í•œ ë¡œì§ í•˜ë‚˜ë§Œ ì‹¤í–‰í•œ í›„ ê²°ê³¼ë¥¼ ì‘ë‹µí•´ì£¼ëŠ” ì‹ìœ¼ë¡œ ë™ì‘í•¨ìœ¼ë¡œì¨ ë™ì ì¸ ì½˜í…ì¸ ì— ëŒ€í•œ ìš”ì²­ì— ë¹ ë¥´ê²Œ ì‘ë‹µí•  ìˆ˜ ìˆê²Œ í•œ ê²ƒì´ë‹¤.</p>

<p>ì´ëŸ¬í•œ WSGIê°€ í‘œì¤€ì ì¸ íŒŒì´ì¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë™ì‘ ë°©ì‹ì´ ë¨ì— ë”°ë¼, WSGI ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ëŠ” ì›¹ ì„œë²„ì˜ ì—­í• ì„ í•˜ê²Œ ë˜ê³  WSGI compatibleí•œ íŒŒì´ì¬ ì•±ì´ WSGI ì„œë²„ì™€ í•©ì³ì ¸ì„œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ ë˜ê²Œ ëœë‹¤.
<img src="https://images.velog.io/images/jimin_lee/post/19d94186-29f9-4cf2-a9c3-0b9e7bb39086/KakaoTalk_20210425_212448657_01.jpg" alt="" /></p>

<p>ì¦‰, ì—¬ê¸°ì„œ WSGI ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ì• ê°€ Gunicornì´ê³ , DjangoëŠ” íŒŒì´ì¬ ì•±ì´ë¼ê³  í•  ìˆ˜ ìˆìœ¼ë©°, ì–˜ë„¤ê°€ í•¨ê»˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ ë˜ëŠ” ê²ƒì´ë‹¤. NginxëŠ” ì—¬ê¸°ì„œ Gunicorn+Djangoì˜ ì•ë‹¨ì— ìœ„ì¹˜í•˜ê³  ìˆëŠ”ë°, WSGIì˜ í”„ë¡œì„¸ìŠ¤ì™€ëŠ” ë³„ ê´€ë ¨ ì—†ì´ buffering, reverse proxyë‚˜ load balanceì™€ ê°™ì€ ë³„ë„ì˜ ì¼ì„ ìˆ˜í–‰í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.</p>

<h2 id="2-wsgiì˜-ë™ì‘-ê³¼ì •">2. WSGIì˜ ë™ì‘ ê³¼ì •</h2>

<p>WSGIì— ëŒ€í•´ ì¢€ ë” ê°ì„ ì¡ê¸° ìœ„í•´ <a href="https://www.python.org/dev/peps/pep-0333/#specification-overview">PEP333</a>ì— ë‚˜ì™€ìˆëŠ” WSGIì˜ ë™ì‘ ê³¼ì •ì„ í•œ ë²ˆ ì‚´í´ë³´ë ¤ê³  í•œë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ë§í•˜ì§€ë§Œ WSGIëŠ” ë³„ë„ì˜ í”„ë ˆì„ì›Œí¬ ê°™ì€ ê²Œ ì•„ë‹ˆë¼, ë™ì ì¸ ë°ì´í„°ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ì„œ ì›¹ ì„œë²„ì™€ íŒŒì´ì¬ ì›¹ ì•±ì´ ì–´ë–»ê²Œ ì„œë¡œ ë™ì‘í•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” specificationì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.</p>

<p>ê³µì‹ ë¬¸ì„œì—ì„œëŠ” WSGIë¥¼ <strong>â€œsimple and universal interface between web servers and web applications or frameworksâ€</strong>ë¼ê³  ì„¤ëª…í•˜ê³  ìˆìœ¼ë©°, WSGIì˜ ëª©ì ì€ <strong>â€œto facilitate easy interconnection of existing servers and applications or frameworks, not to create a new web frameworkâ€</strong>ë¼ê³  ì„œìˆ í•˜ê³  ìˆë‹¤.</p>

<p>WSGIëŠ” server/gateway sideì™€ application/framework sideë¥¼ ê°€ì§€ëŠ”ë°, server sideì—ì„œ ë“¤ì–´ì˜¨ ìš”ì²­ì´ application sideì˜ callable objectë¥¼ í˜¸ì¶œ(invoke)í•˜ê²Œ ëœë‹¤. ì—¬ê¸°ì„œ callable objectë€ ê³§ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì •ì˜í•œ applicationì„ ì˜ë¯¸í•˜ê³ , objectë¼ê³ ëŠ” í–ˆì§€ë§Œ callableí•œ ì–´ë–¤ í˜•íƒœë“ ì§€ ìƒê´€ì€ ì—†ë‹¤.</p>

<p><img src="https://images.velog.io/images/jimin_lee/post/d5fd03ea-666a-4a0b-8a03-d574cd7a34f0/KakaoTalk_20210425_212448657.jpg" alt="" /></p>

<p>ê°ê°ì˜ ì½”ë“œë¥¼ í•œ ë²ˆ ì‚´í´ë³´ì.</p>

<h3 id="applicationframework-side">Application/Framework Side</h3>

<p>ë‹¤ìŒì€ í•¨ìˆ˜ í˜•íƒœì˜ applicationì´ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="s">"""Simplest possible application object"""</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s">'200 OK'</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text/plain'</span><span class="p">)]</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">'Hello world!</span><span class="se">\n</span><span class="s">'</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>applicationì€ environ ê°ì²´ì™€ start_responseë¼ëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.</li>
  <li>environì€ methodë‚˜ url ë“± HTTP ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ CGI í™˜ê²½ ë³€ìˆ˜ì˜ í˜•ì‹ìœ¼ë¡œ ë‹´ê³  ìˆëŠ” dictionary í˜•íƒœì˜ ê°ì²´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.</li>
  <li>start_response ì½œë°± í•¨ìˆ˜ëŠ” statusì™€ response_headersë¼ëŠ” ë‘ ê°€ì§€ ì¸ìë¥¼ ë°›ëŠ”ë‹¤.</li>
  <li>statusì—ëŠ” <code class="language-plaintext highlighter-rouge">200 OK</code> ì™€ ê°™ì€ HTTP status ì½”ë“œê°€ ë“¤ì–´ê°€ê³ , response_headersì—ëŠ” HTTP í—¤ë”ê°€ ë“¤ì–´ê°„ë‹¤.</li>
</ul>

<h3 id="servergateway-side">Server/Gateway Side</h3>

<p>server sideì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ applicationì„ í˜¸ì¶œí•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">sys</span>

<span class="k">def</span> <span class="nf">run_with_cgi</span><span class="p">(</span><span class="n">application</span><span class="p">):</span> <span class="c1"># applicationì„ ì¸ìë¡œ ë°›ìŒ
</span>    <span class="c1"># environ ê°ì²´
</span>    <span class="n">environ</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.input'</span><span class="p">]</span>        <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stdin</span>  <span class="c1"># stdinì˜ í˜•íƒœë¡œ inputì„ ë°›ìŒ
</span>    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.errors'</span><span class="p">]</span>       <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.version'</span><span class="p">]</span>      <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.multithread'</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">False</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.multiprocess'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.run_once'</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'HTTPS'</span><span class="p">,</span> <span class="s">'off'</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s">'on'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">):</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.url_scheme'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'https'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.url_scheme'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'http'</span>

    <span class="n">headers_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">headers_sent</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">headers_set</span><span class="p">:</span>
             <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">"write() before start_response()"</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">headers_sent</span><span class="p">:</span>
             <span class="c1"># Before the first output, send the stored headers
</span>             <span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span> <span class="o">=</span> <span class="n">headers_sent</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">headers_set</span>
             <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'Status: %s</span><span class="se">\r\n</span><span class="s">'</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">response_headers</span><span class="p">:</span>
                 <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'%s: %s</span><span class="se">\r\n</span><span class="s">'</span> <span class="o">%</span> <span class="n">header</span><span class="p">)</span>
             <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>

        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span>

		<span class="c1"># statusì™€ response_headersë¥¼ ë°›ëŠ” start_response ì½œë°±í•¨ìˆ˜ 
</span>    <span class="k">def</span> <span class="nf">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">headers_sent</span><span class="p">:</span>
                    <span class="c1"># Re-raise original exception if headers sent
</span>                    <span class="k">raise</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">exc_info</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c1"># avoid dangling circular ref
</span>        <span class="k">elif</span> <span class="n">headers_set</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">"Headers already set!"</span><span class="p">)</span>

        <span class="n">headers_set</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">write</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">application</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>    <span class="c1"># don't send headers until body appears
</span>                <span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">headers_sent</span><span class="p">:</span>
            <span class="n">write</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>   <span class="c1"># send headers now if body was empty
</span>    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">'close'</span><span class="p">):</span>
            <span class="n">result</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> 
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ì°¸ê³ </code> <strong>WSGI Middleware</strong></p>

<ul>
  <li>WSGI server/gateway sideì™€ application/framework sideë¥¼ ë‘˜ ë‹¤ êµ¬í˜„í•˜ê³  ìˆëŠ” í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨</li>
  <li>ì„œë²„ì— ëŒ€í•´ì„œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê³ , ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ì„œëŠ” ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰.</li>
  <li>ë™ì‘ ê³¼ì • : í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ â†’ server sideì—ì„œ middleware componentë¥¼ í˜¸ì¶œ â†’ middleware componentê°€ application sideì˜ applicationì„ í˜¸ì¶œ</li>
  <li><strong>Gunicorn, uWSGI</strong></li>
</ul>

<h2 id="3-frameworkì˜-wsgi-application">3. Frameworkì˜ WSGI application</h2>

<p>ì´ë²ˆì—ëŠ” ëŒ€í‘œì ì¸ íŒŒì´ì¬ í”„ë ˆì„ì›Œí¬ì¸ Djangoì™€ Flaskì— ë‚´ì¥ëœ WSGI applicationì„ í•œ ë²ˆ ì‚´í´ë³´ë ¤ê³  í•œë‹¤.</p>

<h3 id="django">Django</h3>

<p>ğŸ“ django projectë¥¼ ìƒì„±í•˜ë©´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” wsgi.py íŒŒì¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""
WSGI config for movie_project project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/3.1/howto/deployment/wsgi/
"""</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">django.core.wsgi</span> <span class="kn">import</span> <span class="n">get_wsgi_application</span>

<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">'DJANGO_SETTINGS_MODULE'</span><span class="p">,</span> <span class="s">'movie_project.settings'</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">get_wsgi_application</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ django.core.wsgi.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">django</span>
<span class="kn">from</span> <span class="nn">django.core.handlers.wsgi</span> <span class="kn">import</span> <span class="n">WSGIHandler</span>

<span class="k">def</span> <span class="nf">get_wsgi_application</span><span class="p">():</span>
    <span class="s">"""
    The public interface to Django's WSGI support. Return a WSGI callable.
    Avoids making django.core.handlers.WSGIHandler a public API, in case the
    internal WSGI implementation changes or moves in the future.
    """</span>
    <span class="n">django</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">set_prefix</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">WSGIHandler</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ django.core.handlers.wsgi.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">WSGIHandler</span><span class="p">(</span><span class="n">base</span><span class="p">.</span><span class="n">BaseHandler</span><span class="p">):</span>
    <span class="n">request_class</span> <span class="o">=</span> <span class="n">WSGIRequest</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">load_middleware</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">set_script_prefix</span><span class="p">(</span><span class="n">get_script_name</span><span class="p">(</span><span class="n">environ</span><span class="p">))</span>
        <span class="n">signals</span><span class="p">.</span><span class="n">request_started</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">request_class</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="n">response</span><span class="p">.</span><span class="n">_handler_class</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s">'%d %s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">reason_phrase</span><span class="p">)</span>
        <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="n">response</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span>
            <span class="o">*</span><span class="p">((</span><span class="s">'Set-Cookie'</span><span class="p">,</span> <span class="n">c</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s">''</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="p">]</span>
        <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">response_headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'file_to_stream'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'wsgi.file_wrapper'</span><span class="p">):</span>
            <span class="c1"># If `wsgi.file_wrapper` is used the WSGI server does not call
</span>            <span class="c1"># .close on the response, but on the file wrapper. Patch it to use
</span>            <span class="c1"># response.close instead which takes care of closing all files.
</span>            <span class="n">response</span><span class="p">.</span><span class="n">file_to_stream</span><span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">close</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">environ</span><span class="p">[</span><span class="s">'wsgi.file_wrapper'</span><span class="p">](</span><span class="n">response</span><span class="p">.</span><span class="n">file_to_stream</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">block_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h3 id="flask">Flask</h3>

<p>ğŸ“ flask app.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">"Hello World!"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>ğŸ“ flask.src.flask.app.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">Scaffold</span><span class="p">):</span>
    <span class="s">"""The flask object implements a WSGI application and acts as the central
    object.  It is passed the name of the module or package of the
    application.  Once it is created it will act as a central registry for
    the view functions, the URL rules, template configuration and much more.
    The name of the package is used to resolve resources from inside the
    package or the folder the module is contained in depending on if the
    package parameter resolves to an actual python package (a folder with
    an :file:`__init__.py` file inside) or a standard module (just a ``.py`` file).
    """</span>

	<span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
	        <span class="s">"""The actual WSGI application. This is not implemented in
	        :meth:`__call__` so that middlewares can be applied without
	        losing a reference to the app object. Instead of doing this::
	            app = MyMiddleware(app)
	        It's a better idea to do this instead::
	            app.wsgi_app = MyMiddleware(app.wsgi_app)
	        Then you still have the original application object around and
	        can continue to call methods on it.
	        
	        :param environ: A WSGI environment. 
	        :param start_response: A callable accepting a status code,
	            a list of headers, and an optional exception context to
	            start the response.
	        """</span>
	        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
	        <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
	        <span class="k">try</span><span class="p">:</span>
	            <span class="k">try</span><span class="p">:</span>
	                <span class="n">ctx</span><span class="p">.</span><span class="n">push</span><span class="p">()</span>
	                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">full_dispatch_request</span><span class="p">()</span>
	            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	                <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
	                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
	            <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: B001
</span>	                <span class="n">error</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
	                <span class="k">raise</span>
	            <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
	        <span class="k">finally</span><span class="p">:</span>
	            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">should_ignore_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
	                <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
	            <span class="n">ctx</span><span class="p">.</span><span class="n">auto_pop</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
            <span class="s">"""The WSGI server calls the Flask application object as the
            WSGI application. This calls :meth:`wsgi_app`, which can be
            wrapped to apply middleware.
            """</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">wsgi_app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="4-ì •ë¦¬">4. ì •ë¦¬</h2>

<p>âœ” <strong>Gunicornì€ ì™œ í•„ìš”í•œê°€?</strong> ì›¹ ì•±ì— HTTP ìš”ì²­ì„ ì „ë‹¬í•˜ê³  ì‘ë‹µì„ ë˜ëŒë ¤ì£¼ëŠ” ì¼ì„ í•  WSGI serverì˜ ì—­í• ì„ í•˜ê¸° ìœ„í•´ì„œ â†’ WSGI middleware</p>

<p>âœ” <strong>NginxëŠ” ì™œ í•„ìš”í•œê°€?</strong> reverse proxy server, load balancer ë“±ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ</p>

<p>âœ” <strong>Django/FlaskëŠ” ì™œ í•„ìš”í•œê°€?</strong> WSGI compatible serverë¥¼ ì•Œì•„ì„œ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. raw WSGI applicationì„ ë§Œë“¤ ìˆ˜ëŠ” ìˆì§€ë§Œ ê¸°ëŠ¥ì„ ì¼ì¼ì´ ë‹¤ êµ¬í˜„í•˜ê¸° ë²ˆê±°ë¡­ê³  ë„ˆë¬´ ë§ì€ ì½”ë„ˆ ì¼€ì´ìŠ¤ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ê¶Œì¥í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.  ê·¸ë˜ì„œ ì´ë¯¸  sessionì´ë‚˜ cookieì™€ ê°™ì€ ë§ì€ ë¶€ë¶„ì´ êµ¬í˜„ë˜ì–´ ìˆëŠ” í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ëŠ” ê²ƒì´ë‹¤.</p>

<p>âœ” <strong>ê·¸ëŸ¼ ê·¸ëƒ¥ í”„ë ˆì„ì›Œí¬ ì„œë²„ë¥¼ ì›¹ ì„œë²„ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?</strong> ê·¸ë˜ë„ ì•ˆë  ê±´ ì—†ë‹¤. í•˜ì§€ë§Œ ë³´í†µì€ ê·¸ëŸ¬ì§€ ì•ŠëŠ”ë‹¤. í”„ë ˆì„ì›Œí¬ê°€ ì œê³µí•˜ëŠ” development serverëŠ” ì‹¤ì œ íŠ¸ë˜í”½ì— ëŒ€ì‘í•  ìˆ˜ ì—†ê³  ì—¬ëŸ¬ ë¶€ë¶„ì—ì„œ ë¹ˆì•½í•˜ê¸° ë•Œë¬¸ì´ë‹¤. Flask ì•±ì„ ë§Œë“¤ ë•Œ <code class="language-plaintext highlighter-rouge">flask run</code>ì„ í†µí•´ ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ í„°ë¯¸ë„ì— production serverìš©ìœ¼ë¡œëŠ” ì“°ì§€ ë§ë¼ëŠ” ë©”ì„¸ì§€ê°€ ë‚˜ì˜¤ëŠ” ì´ìœ ë„ ì´ ë•Œë¬¸ì´ë‹¤.</p>

<h2 id="ê·¸ë˜ì„œ-ê²°ë¡ ì€">ê·¸ë˜ì„œ ê²°ë¡ ì€?</h2>

<p>âœ… <strong>Gunicornë§Œ ì¨ë„ ë¼?</strong> YES.</p>

<p>Gunicornì´ WSGI middlewareë¡œì„œ ì›¹ ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— Gunicornë§Œ ì¨ë„ ëœë‹¤. ë‹¤ë§Œ, Nginxê°€ ì œê³µí•˜ëŠ” ì¶”ê°€ì ì¸ í˜œíƒì„ ë°›ì§€ ëª»í•  ë¿ì´ë‹¤.</p>

<p>âœ… <strong>Nginxë§Œ ì¨ë„ ë¼?</strong>  YES.</p>

<p>Flaskë‚˜ Django ê°™ì€ í”„ë ˆì„ì›Œí¬ëŠ” WSGI interfaceë¥¼ ì´ë¯¸ ì–´ëŠ ì •ë„ êµ¬í˜„í•´ë†“ì•˜ê¸° ë•Œë¬¸ì— í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ Nginxë§Œ ì¨ë„ ëœë‹¤. ë‹¤ë§Œ session, cookie, routing, authentication ë“±ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•´ì£¼ëŠ” middlewareì˜ ì—­í• ì„ í•˜ëŠ” ì• ê°€ ì—†ê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ì€ ìê¸°ê°€ í•˜ë“œ ì½”ë”©í•´ì•¼ í•œë‹¤. ê²°êµ­, Gunicorn/uWSGIë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ë‹¤ ì“°ëŠ” ê²ƒê³¼ ë˜‘ê°™ë‹¤ê³  í•  ìˆ˜ ìˆê³ , ë°˜ë“œì‹œ ì¨ì•¼ë§Œ í•˜ëŠ” ê±´ ì•„ë‹ˆë‹¤.</p>

<hr />
<h3 id="ì°¸ê³ -ìë£Œ">ì°¸ê³  ìë£Œ</h3>

<ul>
  <li><a href="https://youtu.be/WqrCnVAkLIo">https://youtu.be/WqrCnVAkLIo</a></li>
  <li><a href="https://youtu.be/H6Q3l11fjU0">https://youtu.be/H6Q3l11fjU0</a></li>
  <li><a href="https://www.python.org/dev/peps/pep-0333/#specification-overview">https://www.python.org/dev/peps/pep-0333/#specification-overview</a> (PEP333)</li>
  <li><a href="https://www.nginx.com/resources/glossary/application-server-vs-web-server/">https://www.nginx.com/resources/glossary/application-server-vs-web-server/</a></li>
  <li><a href="https://www.fullstackpython.com/green-unicorn-gunicorn.html#:~:text=Gunicorn%20is%20based%20on%20a,is%20independent%20of%20the%20controller">https://www.fullstackpython.com/green-unicorn-gunicorn.html#:~:text=Gunicorn is based on a,is independent of the controller</a>.</li>
  <li><a href="https://sgc109.github.io/2020/08/15/python-wsgi/">https://sgc109.github.io/2020/08/15/python-wsgi/</a></li>
  <li><a href="http://xplordat.com/2020/02/16/a-flask-full-of-whiskey-wsgi/">http://xplordat.com/2020/02/16/a-flask-full-of-whiskey-wsgi/</a></li>
</ul>

<h3 id="ë”-ì•Œì•„ë³´ê³ -ì‹¶ì€-ë‚´ìš©">ë” ì•Œì•„ë³´ê³  ì‹¶ì€ ë‚´ìš©</h3>

<ul>
  <li>ASGI : <a href="https://youtu.be/uRcnaI8Hnzg">https://youtu.be/uRcnaI8Hnzg</a></li>
</ul>]]></content><author><name>[&quot;jimin-mjl&quot;]</name></author><category term="ì„œë²„ê°œë°œ" /><category term="nginx" /><category term="gunicorn" /><summary type="html"><![CDATA[Flaskë‚˜ Djangoë¡œ ë§Œë“  íŒŒì´ì¬ ì•±ì„ ë°°í¬í•  ë•Œ, ë³´í†µ Nginxì™€ Gunicornê³¼ ìê¸° ì•±ì„ ì—°ê²°í•´ì„œ ë°°í¬í•˜ëŠ” ê²Œ ì •ì„ì²˜ëŸ¼ ì—¬ê²¨ì§„ë‹¤. ì—¬ê¸°ì„œ Nginxë¥¼ Apacheë¡œ, Gunicornì„ uWSGIë¡œ ë°”ê¿”ë„ ìƒê´€ì—†ë‹¤.]]></summary></entry><entry><title type="html">Nginxì™€ Gunicornìœ¼ë¡œ Flaskì•± ë°°í¬í•˜ê¸°</title><link href="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/02/08/deploying-flask-app.html" rel="alternate" type="text/html" title="Nginxì™€ Gunicornìœ¼ë¡œ Flaskì•± ë°°í¬í•˜ê¸°" /><published>2021-02-08T00:00:00+09:00</published><updated>2021-02-08T00:00:00+09:00</updated><id>http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/02/08/deploying-flask-app</id><content type="html" xml:base="http://localhost:4000/%EC%84%9C%EB%B2%84%EA%B0%9C%EB%B0%9C/2021/02/08/deploying-flask-app.html"><![CDATA[<h2 id="1-ì°¸ê³ -ìë£Œ">1. ì°¸ê³  ìë£Œ</h2>
<ul>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04">nginx ì„¤ì¹˜</a></li>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-18-04">gunicorn ì„¤ì¹˜ ë° nginxì™€ ì—°ê²°</a></li>
  <li><a href="https://youtu.be/kDRRtPO0YPA">ìš°ë¶„íˆ¬ ì„œë²„ì—ì„œ flaskì•± ë°°í¬í•˜ê¸°</a></li>
</ul>

<p>ì²˜ìŒì— ì„¸ ë²ˆì§¸ì˜ ì˜ìƒì„ ë³´ê³  ë”°ë¼í–ˆëŠ”ë°, ì—°ê²°ì´ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆì§€ë§Œ gunicornì—ì„œ ë¹ ì ¸ë‚˜ì™”ì„ ë•Œ ì„œë²„ê°€ ë©ˆì¶˜ë‹¤. ë‚´ê°€ ì›í•˜ëŠ” ê±´ ê³„ì† ëŒì•„ê°€ê²Œ í•˜ëŠ” ê±°ì˜€ê¸° ë•Œë¬¸ì— ì´ ì˜ìƒì„ í†µí•´ì„œëŠ” ì—°ê²°ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•œ ë‹¤ìŒ, ìœ„ì˜ ë‘ ê¸€ì„ í†µí•´ ì´í›„ì˜ ë‹¨ê³„ë¥¼ ì§„í–‰í–ˆë‹¤.</p>

<hr />
<h2 id="2-ë“¤ì–´ê°€ê¸°-ì „ì—">2. ë“¤ì–´ê°€ê¸° ì „ì—</h2>
<p>ì²˜ìŒì—ëŠ” nginxì™€ uwsgië¥¼ ì‚¬ìš©í•˜ë ¤ê³  í–ˆëŠ”ë°, uwsgië¥¼ ì„¤ì¹˜í•˜ëŠ”ë° ê³„ì† ì—ëŸ¬ê°€ ë‚˜ì„œ gunicornìœ¼ë¡œ ì‹œë„í•´ë³´ì•˜ë‹¤. (uwsgiëŠ” ì–´ë–»ê²Œ ì½ëŠ” ê±¸ê¹Œ?)</p>

<p>ëª¨ë¥´ëŠ” ê²Œ ë„ˆë¬´ ë§ì•„ì„œ ì•„ì§ ì´í•´ë¥¼ ë‹¤ ëª»í•œ ë¶€ë¶„ë„ ë§ì§€ë§Œ ì¼ë‹¨ ì´í•´í•œ ë§Œí¼ ì ì–´ë³´ì•˜ë‹¤.</p>
<h3 id="2-1-wsgië€">2-1. WSGIë€?</h3>
<p>CGI(Common Gateway Interface)ì˜ ì¼ì¢…ìœ¼ë¡œ, í”„ë ˆì„ì›Œí¬ì˜ ì›¹ ì„œë²„ì´ë‹¤.</p>

<p>WSGIì—ëŠ” ë‘ ì¢…ë¥˜ê°€ ìˆë‹¤.</p>
<ul>
  <li>web server : Nginx, Apache</li>
  <li>web app : íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼</li>
</ul>

<p>ê·¸ëŸ¼ Gunicorn, uWSGIì€? web serverì™€ web appì˜ middlewareë¼ê³  í•  ìˆ˜ ìˆë‹¤.</p>

<p>ì •ë¦¬í•˜ìë©´ ì´ëŸ° ì‹ì´ë‹¤.</p>
<ul>
  <li>ë‚´ê°€ ë§Œë“  ì•± : flask app</li>
  <li>ì›¹ ì„œë²„ : nginx</li>
  <li>ì•±ê³¼ ì›¹ ì„œë²„ë¥¼ ì—°ê²°í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´: gunicorn</li>
</ul>

<h4 id="ì°¸ê³ -ê¸€"><a href="https://paphopu.tistory.com/entry/WSGI%EC%97%90-%EB%8C%80%ED%95%9C-%EC%84%A4%EB%AA%85-WSGI%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80">ì°¸ê³  ê¸€</a></h4>

<h3 id="2-2-ì „ì²´-í”„ë¡œì„¸ìŠ¤">2-2. ì „ì²´ í”„ë¡œì„¸ìŠ¤</h3>
<blockquote>
  <p>client request -&gt; nginx : web proxy server -&gt; gunicorn : application server -&gt; flask app</p>
</blockquote>

<p>ì„œë²„ê°€ ì‘ë‹µí•  ë•ŒëŠ” ìš”ì²­ ë°›ì€ ìˆœì„œ ë°˜ëŒ€ë¡œ ìˆ˜í–‰í•œë‹¤. 
ì°¸ê³ ë¡œ proxy serverëŠ”  í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ë¥¼ ì¤‘ê³„í•˜ëŠ” ì„œë²„ì´ë‹¤.</p>

<hr />
<h2 id="3-nginx">3. Nginx</h2>
<h3 id="3-1-nginx-ì„¤ì¹˜í•˜ê¸°">3-1. Nginx ì„¤ì¹˜í•˜ê¸°</h3>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update 
<span class="nb">sudo </span>apt <span class="nb">install </span>nginx 
</code></pre></div></div>
<h3 id="3-2-ë°©í™”ë²½-ì„¤ì •í•˜ê¸°">3-2. ë°©í™”ë²½ ì„¤ì •í•˜ê¸°</h3>
<p>nginxì˜ ì ‘ê·¼ì„ í—ˆìš©í•˜ê¸° ìœ„í•´ ë°©í™”ë²½ ì„¤ì •ë¶€í„° í•´ì¤˜ì•¼ í•œë‹¤. 
ìš°ì„  <code class="language-plaintext highlighter-rouge">sudo ufw app list</code> ë¥¼ í†µí•´ ì„¤ì • ê°€ëŠ¥í•œ ë°©í™”ë²½ì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì˜¨ë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Available applications:
  Nginx Full    // HTTP, HTTPS ëª¨ë‘ í—ˆìš©
  Nginx HTTP    // HTTPë§Œ í—ˆìš©
  Nginx HTTPS   // HTTPSë§Œ í—ˆìš©
  OpenSSH
</code></pre></div></div>
<p>ì„¤ì •ì€ <code class="language-plaintext highlighter-rouge">sudo ufw allow 'Nginx HTTP'</code> ë¥¼ í†µí•´ ê°€ëŠ¥í•˜ê³ ,
<code class="language-plaintext highlighter-rouge">sudo ufw status</code> ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<h3 id="3-3-ì›¹-ì„œë²„-í™•ì¸í•˜ê¸°">3-3. ì›¹ ì„œë²„ í™•ì¸í•˜ê¸°</h3>
<p>nginxê°€ ì„¤ì¹˜ë˜ë©´ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. 
ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ <code class="language-plaintext highlighter-rouge">systemctl status nginx</code> ë¡œ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>ê·¸ëŸ°ë°, ë‚´ ê²½ìš°ì—ëŠ” ì´ê²Œ inactive ìƒíƒœì˜€ë‹¤. 
ê·¸ë˜ì„œ <code class="language-plaintext highlighter-rouge">sudo ufw enable</code> ì„ ì¶”ê°€ì ìœ¼ë¡œ ì…ë ¥í•´ì„œ activeìƒíƒœë¡œ ë§Œë“¤ì—ˆë‹¤.</p>
<h3 id="3-4-ë¶€ë¡--nginx-ìƒíƒœ-ê´€ë ¨-ëª…ë ¹ì–´-ì •ë¦¬">3-4. ë¶€ë¡ : Nginx ìƒíƒœ ê´€ë ¨ ëª…ë ¹ì–´ ì •ë¦¬</h3>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start nginx   // nginx ì‹œì‘
<span class="nb">sudo </span>systemctl stop nginx   // nginx ë©ˆì¶”ê¸°
<span class="nb">sudo </span>systemctl restart nginx   // nginx ì¬ì‹œì‘<span class="o">(</span>ë©ˆì¶”ê³  ë‹¤ì‹œ ì‹œì‘<span class="o">)</span>
<span class="nb">sudo </span>systemctl reload nginx   // ì„¤ì • íŒŒì¼ë§Œ ìˆ˜ì •í–ˆì„ ê²½ìš° ì—°ê²°ì„ ëŠì§€ ì•Šê³  ìˆ˜ì •ì‚¬í•­ ì ìš©ì‹œí‚¤ê¸°
<span class="nb">sudo </span>systemctl disable nginx   // nginxëŠ” ì„œë²„ê°€ ë¶€íŒ…ë˜ë©´ ìë™ìœ¼ë¡œ ì‹œì‘ëœë‹¤. ì´ ì„¤ì •ì„ ì§€ìš°ê¸°
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>nginx   // ìœ„ì˜ ì„¤ì •ì„ ë‹¤ì‹œ <span class="nb">enable </span>ì‹œí‚¤ê¸°
</code></pre></div></div>
<hr />
<h2 id="4-gunicorn">4. Gunicorn</h2>
<h3 id="4-1-ì„¤ì¹˜-ì „ì—-ì˜ì¡´-íŒ¨í‚¤ì§€-ì„¤ì¹˜í•˜ê¸°">4-1. ì„¤ì¹˜ ì „ì— ì˜ì¡´ íŒ¨í‚¤ì§€ ì„¤ì¹˜í•˜ê¸°</h3>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>python3-pip python3-dev build-essential libssl-dev libffi-dev python3-setuptools
</code></pre></div></div>
<h3 id="4-2-ê°€ìƒí™˜ê²½-ì„¤ì¹˜í•˜ê³ -ì ‘ì†í•˜ê¸°">4-2. ê°€ìƒí™˜ê²½ ì„¤ì¹˜í•˜ê³  ì ‘ì†í•˜ê¸°</h3>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>python3-venv
python3 <span class="nt">-m</span> venv venv-name
<span class="nb">source </span>venv-name/bin/activate
</code></pre></div></div>
<p>ì´ì œ ê°€ìƒí™˜ê²½ ì•ˆì—ì„œ ì‘ì—…í•œë‹¤.</p>
<h3 id="4-3-gunicorn-ì„¤ì¹˜í•˜ê¸°">4-3. Gunicorn ì„¤ì¹˜í•˜ê¸°</h3>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>wheel // packageì— wheel archiveê°€ ì—†ì–´ë„ ì„¤ì¹˜ë˜ê²Œë” í•˜ê¸° ìœ„í•´ì„œë¼ëŠ”ë° ì¼ë‹¨ ì„¤ì¹˜í•œë‹¤. 
pip <span class="nb">install </span>gunicorn flask
which gunicorn // gunicorn ê²½ë¡œ í™•ì¸í•˜ê¸°
</code></pre></div></div>
<p>wheel ê°™ì€ ê²½ìš°ëŠ” uwsgië¥¼ ì„¤ì¹˜í•˜ë ¤ê³  í–ˆì„ ë•Œ uwsgië¥¼ ìœ„í•œ wheelì´ ì—†ë‹¤ëŠ” ì—ëŸ¬ ë©”ì„¸ì§€ê°€ ê³„ì† ëœ¨ë˜ë° ê·¸ëŸ° ê±¸ ë§í•˜ëŠ” ê²ƒ ê°™ë‹¤.</p>
<h3 id="4-4-entry-point-íŒŒì¼-ë§Œë“¤ê¸°">4-4. Entry Point íŒŒì¼ ë§Œë“¤ê¸°</h3>
<p>appì„ importí•œ wsgi.py íŒŒì¼ì„ ë§Œë“¤ì–´ì¤¬ë‹¤. app.pyë¥¼ ê·¸ëƒ¥ entry pointë¡œ ì¨ë„ ë˜ì§€ ì•Šì„ê¹Œ ì‹¶ì–´ì„œ ì²˜ìŒì—ëŠ” ë”°ë¡œ ë§Œë“¤ì§€ ì•Šì•˜ëŠ”ë° ë‚˜ì¤‘ì— ì—ëŸ¬ê°€ ë‚˜ì„œ ì°¾ì•„ë³´ë‹¤ê°€ djangoëŠ” wsgi.pyíŒŒì¼ì„ ì°¾ì•„ë³¸ë‹¤ëŠ” ì†Œë¦¬ë¥¼ ë“¤ì—ˆë‹¤. ê·¼ë° ì´ê±´ flask ì•±ì¸ë° ì´ ë¬¸ì œê°€ ë§ì„ê¹Œ ì‹¶ì—ˆì§€ë§Œ í˜¹ì‹œ ëª¨ë¥´ë‹ˆê¹Œ ì¼ë‹¨ ë§Œë“¤ì–´ì¤¬ë‹¤.</p>

<p>ë§Œë“¤ê³  ë‚˜ì„œ ì‹¤í–‰ë˜ëŠ”ì§€ ì²´í¬í•´ë³´ê¸° : <code class="language-plaintext highlighter-rouge">gunicorn wsgi:app</code>
wsgiëŠ” íŒŒì¼ ì´ë¦„ì´ê³  appì€ app ì´ë¦„ì´ë‹¤.</p>

<h3 id="4-5-service-íŒŒì¼-ë§Œë“¤ê¸°">4-5. service íŒŒì¼ ë§Œë“¤ê¸°</h3>
<p>ê°€ìƒí™˜ê²½ì—ì„œ ë¹ ì ¸ë‚˜ì™€ì„œ ì‘ì—…í•œë‹¤. 
ë¹ ì ¸ë‚˜ì˜¤ëŠ” ëª…ë ¹ì–´ëŠ” <code class="language-plaintext highlighter-rouge">deactivate</code>.</p>
<h4 id="1-etcsystemdsystem-ë””ë ‰í† ë¦¬-ì•ˆì—-etcsystemdsystemmyflaskservice-íŒŒì¼ì„-ë§Œë“¤ì–´ì¤€ë‹¤">1) /etc/systemd/system/ ë””ë ‰í† ë¦¬ ì•ˆì— /etc/systemd/system/myflask.service íŒŒì¼ì„ ë§Œë“¤ì–´ì¤€ë‹¤.</h4>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/systemd/system/myproject.service   // ì°¸ê³ ë¡œ etc ì•ì— /ê°€ ì•ˆë¶™ìœ¼ë©´ ìƒˆë¡œìš´ íŒŒì¼ì¼ ê²½ìš° ì•Œì•„ì„œ ë§Œë“¤ì–´ì£¼ì§€ ì•Šìœ¼ë‹ˆ ë¶™ì—¬ì¤€ë‹¤.
</code></pre></div></div>
<p>íŒŒì¼ ì´ë¦„ì€ ì•„ë¬´ê±°ë‚˜ í•´ë„ ìƒê´€ì—†ì§€ë§Œ ë˜ë„ë¡ ë‹¤ë¥¸ íŒŒì¼ ì´ë¦„ì´ë‚˜ ë””ë ‰í† ë¦¬ ì´ë¦„ì´ë‘ í†µì¼ì‹œì¼œì£¼ìâ€¦! í—·ê°ˆë ¤ ì£½ê² ë‹¤.
ì—¬ê¸°ì„œëŠ” êµ¬ë¶„ì„ ìœ„í•´ íŒŒì¼ ì´ë¦„ì€ myflask, í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì´ë¦„ì€ myproject, ìœ ì € ì´ë¦„ì€ usermeë¡œ í–ˆë‹¤.</p>

<h4 id="2-ë‹¤ìŒì˜-ë‚´ìš©ì„-ì‘ì„±í•œë‹¤">2) ë‹¤ìŒì˜ ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=Gunicorn instance to serve myflask
After=network.target

[Service]
User=userme
Group=www-data
WorkingDirectory=/home/userme/myproject
Environment="PATH=/home/userme/myproject/myproject-env/bin"
ExecStart=/home/userme/myproject/myproject-env/bin/gunicorn --workers 3 --bind unix:myflask.sock -m 007 wsgi:app

[Install]
WantedBy=multi-user.target
</code></pre></div></div>
<p>unix:myflask.sock ë¶€ë¶„ì´ nginxì™€ ì—°ê²°ë  socket íŒŒì¼ì´ë‹¤.</p>
<h4 id="3-service-íŒŒì¼-ì‹¤í–‰ì‹œí‚¤ê³ -ìƒíƒœ-í™•ì¸í•˜ê¸°">3) service íŒŒì¼ ì‹¤í–‰ì‹œí‚¤ê³  ìƒíƒœ í™•ì¸í•˜ê¸°</h4>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start myflask
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>myflask
<span class="nb">sudo </span>systemctl status myflask
</code></pre></div></div>
<h4 id="4-ì˜¤ë¥˜-í•´ê²°í•˜ê¸°">4) ì˜¤ë¥˜ í•´ê²°í•˜ê¸°</h4>
<p>ìœ„ì˜ ì˜ˆì‹œ ê·¸ëŒ€ë¡œ í–ˆë”ë‹ˆ ìƒíƒœê°€ failed(result:exit-code) ë¡œ ëœ¨ê¸¸ë˜,
service íŒŒì¼ì˜ <code class="language-plaintext highlighter-rouge">ExecStart= --workers 3</code> 
ì´ ë¶€ë¶„ì„ <code class="language-plaintext highlighter-rouge">--workers 1</code> ìœ¼ë¡œ ë°”ê¿”ì¤€ ë‹¤ìŒ,
<code class="language-plaintext highlighter-rouge">sudo systemctl restart myflask</code> ë¡œ ì¬ì‹œì‘í–ˆë”ë‹ˆ ì˜ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.</p>

<hr />

<h2 id="5-gunicornì„-nginxì™€-ì—°ê²°ì‹œí‚¤ê¸°">5. Gunicornì„ Nginxì™€ ì—°ê²°ì‹œí‚¤ê¸°</h2>
<h3 id="5-1-ë“¤ì–´ê°€ê¸°-ì „ì—">5-1. ë“¤ì–´ê°€ê¸° ì „ì—</h3>
<p>ìš°ì„  nginxì˜ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ì´í•´í•  í•„ìš”ê°€ ìˆë‹¤.
ë‚˜ë„ ìì„¸íˆëŠ” ì´í•´í•˜ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì— ìš°ì„  ì´í•´í•œ ë§Œí¼ë§Œ ì ì–´ë³¸ë‹¤.
ì—¬ê¸°ì„œëŠ” ë‘ ê°œë§Œ ì•Œë©´ ëœë‹¤.</p>
<ul>
  <li>/etc/nginx/sites-available/ : ì—¬ê¸°ì„œ ì„¤ì • íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ìˆ˜ì •í•œë‹¤.</li>
  <li>/etc/nginx/sites-enabled/ : sited-available ë””ë ‰í† ë¦¬ì˜ ì„¤ì • íŒŒì¼ì´ ì´ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ê³¼ linkë˜ì–´ nginxì— ì ìš©ëœë‹¤.</li>
</ul>

<p>ì •ë¦¬í•˜ìë©´, ì„¤ì •íŒŒì¼ì„ ìš°ë¦¬ê°€ ìƒì„±í•˜ê³  ìˆ˜ì •í•  ë•ŒëŠ” sites-availableì— ìˆëŠ” íŒŒì¼ì„ ê±´ë“œë¦¬ê³  sites-enabledì˜ íŒŒì¼ì€ ì§ì ‘ ê±´ë“œë¦¬ì§€ ì•ŠëŠ”ë‹¤.
ê·¸ëŸ°ë° nginxëŠ” sites-enabledë¥¼ ì°¾ì•„ë³´ì§€ sites-availableì„ ì°¾ì•„ë³´ì§€ ì•ŠëŠ”ë‹¤.
ê·¸ë˜ì„œ sites-availableì—ì„œ ìˆ˜ì •í•œ íŒŒì¼ì„ sites-enableì˜ íŒŒì¼ê³¼ ë§í¬ì‹œì¼œì„œ ìˆ˜ì • ì‚¬í•­ì´ ë°˜ì˜ë˜ë„ë¡ í•œë‹¤.
(ê·¸ëŸ°ë° ì°¸ê³ í•œ ì˜ìƒì—ì„œëŠ” ë°”ë¡œ sites-enabledì˜ íŒŒì¼ì„ ìˆ˜ì •í•˜ë˜ë° ë³„ ìƒê´€ ì—†ëŠ”ê±´ê°€ ì‹¶ê¸°ë„ í•˜ë‹¤)</p>

<h3 id="5-2-nginxì˜-ì„¤ì •-íŒŒì¼-ìƒì„±í•˜ê¸°">5-2. nginxì˜ ì„¤ì • íŒŒì¼ ìƒì„±í•˜ê¸°</h3>
<p>/etc/nginx/sites-available/ì— ìƒˆ ì„¤ì • íŒŒì¼ì„ ë§Œë“¤ì–´ì¤€ë‹¤.</p>
<h4 id="a-ê¸°ì¡´ì˜-íŒŒì¼defaultì„-ì‚­ì œí•˜ê³ -ë‚´-ê²ƒmyflaskìœ¼ë¡œ-ë‹¤ì‹œ-ë§Œë“¤ì–´ì¤€ë‹¤">a. ê¸°ì¡´ì˜ íŒŒì¼(default)ì„ ì‚­ì œí•˜ê³  ë‚´ ê²ƒ(myflask)ìœ¼ë¡œ ë‹¤ì‹œ ë§Œë“¤ì–´ì¤€ë‹¤.</h4>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> /etc/nginx/sites-available/default
<span class="nb">sudo rm</span> /etc/nginx/sites-enabled/default
<span class="nb">sudo touch</span> /etc/nginx/sites-available/myflask
</code></pre></div></div>
<h4 id="b-ì—ë””í„°ë¡œ-ì—´ì–´ì„œ-ë‹¤ìŒì˜-ë‚´ìš©ì„-ì‘ì„±í•˜ê³ -ì €ì¥í•œë‹¤">b. ì—ë””í„°ë¡œ ì—´ì–´ì„œ ë‹¤ìŒì˜ ë‚´ìš©ì„ ì‘ì„±í•˜ê³  ì €ì¥í•œë‹¤.</h4>
<p><code class="language-plaintext highlighter-rouge">sudo nano /etc/nginx/sites-available/myflask</code> ë¡œ íŒŒì¼ì„ ì—´ì–´ì¤€ë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server {
	listen 80 default_server;
	listen [::]:80 default_server;
	server_name 0.0.0.0;
	location / {
		include proxy_params;
		proxy_pass http://unix:/home/sammy/myproject/myproject.sock; // gunicorn service íŒŒì¼ì—ì„œ socket íŒŒì¼ì˜ ê²½ë¡œ
	}
}
</code></pre></div></div>
<p>ë‚´ ê²½ìš° proxy_passëŠ” <code class="language-plaintext highlighter-rouge">http://unix:/home/userme/myproject/myflask.sock</code> ì´ë‹¤.</p>
<h3 id="5-3-sites-availableì˜-íŒŒì¼ê³¼-sites-enabledì˜-íŒŒì¼ì„-ì—°ê²°ì‹œí‚¤ê¸°">5-3. sites-availableì˜ íŒŒì¼ê³¼ sites-enabledì˜ íŒŒì¼ì„ ì—°ê²°ì‹œí‚¤ê¸°</h3>
<p>ë‘ ë””ë ‰í† ë¦¬ì˜ ì„œë¡œ ë‹¤ë¥¸ íŒŒì¼ ì‚¬ì´ì— ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•´ì„œ ì—°ê²°ì‹œí‚¤ëŠ” ì‘ì—…ì„ í•´ì¤€ë‹¤.</p>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/myflask /etc/nginx/sites-enabled/myflask    
</code></pre></div></div>
<p>ln : link, -s : symbolic</p>
<h3 id="5-4-ë§ˆë¬´ë¦¬-ì‘ì—…">5-4. ë§ˆë¬´ë¦¬ ì‘ì—…</h3>
<p>ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ë‹¹ ì„¤ì • íŒŒì¼ì— ë¬¸ë²• ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ ì²´í¬í•˜ê³ , ì•„ë¬´ ë¬¸ì œê°€ ì—†ìœ¼ë©´ nginxë¥¼ ì¬ì‹œì‘í•œë‹¤.</p>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nginx <span class="nt">-t</span>  // ë¬¸ë²• ì˜¤ë¥˜ ì²´í¬
<span class="nb">sudo </span>systemctl restart nginx
</code></pre></div></div>
<h3 id="5-5-ì ‘ì†í•´ì„œ-í™•ì¸í•˜ê¸°">5-5. ì ‘ì†í•´ì„œ í™•ì¸í•˜ê¸°</h3>
<p>ì´ì œ ì›ê²© IP ì£¼ì†Œë¡œ ì ‘ì†í•´ì„œ ì˜ ëœ¨ëŠ”ì§€ í™•ì¸í•˜ë©´ ë!</p>
<h3 id="5-6-ì •ìƒ-ì‘ë™í•˜ì§€-ì•ŠëŠ”ë‹¤ë©´">5-6. ì •ìƒ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´</h3>
<p>ë§Œì•½ ì—¬ê¸°ì„œ ì˜ ì•ˆë˜ë©´ ë°©í™”ë²½ì„ í™•ì¸í•´ë³´ì. ê°€ìƒë¨¸ì‹ ì˜ ë„¤íŠ¸ì›Œí‚¹ë„ í™•ì¸í•´ë³´ë©´ì„œ ì´ê²ƒì €ê²ƒ ì‹œë„í•´ë³´ì!</p>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw app list
<span class="nb">sudo </span>ufw allow <span class="s1">'Nginx Full'</span>  // HTTP, HTTPS ëª¨ë‘ ì ‘ê·¼ í—ˆìš©
<span class="nb">sudo </span>ufw status
</code></pre></div></div>]]></content><author><name>[&quot;jimin-mjl&quot;]</name></author><category term="ì„œë²„ê°œë°œ" /><category term="nginx" /><category term="gunicorn" /><category term="flask" /><summary type="html"><![CDATA[1. ì°¸ê³  ìë£Œ nginx ì„¤ì¹˜ gunicorn ì„¤ì¹˜ ë° nginxì™€ ì—°ê²° ìš°ë¶„íˆ¬ ì„œë²„ì—ì„œ flaskì•± ë°°í¬í•˜ê¸°]]></summary></entry></feed>